<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¿ãƒƒãƒ—RPG å®Œå…¨çµ±åˆç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:#111;color:#fff;font-family:sans-serif;text-align:center;margin:0;padding:20px}
button,input{font-size:14px;padding:8px 14px;margin:4px}
#tapBtn{font-size:26px;padding:28px 56px;margin-top:20px}
.hidden{display:none!important}
.boss{font-size:72px}
.player{font-size:60px}
.hp-bar{width:80%;height:20px;background:#444;margin:10px auto;border-radius:10px;overflow:hidden}
.hp{height:100%;background:red}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;justify-content:center;align-items:center;z-index:999;font-size:20px;text-align:center;padding:20px}
</style>
</head>
<body>

<h1>ğŸ”¥ ã‚¿ãƒƒãƒ—RPG ğŸ”¥</h1>

<p>
ğŸ’° <span id="coin">0</span>
ã€€ğŸ’ <span id="dia">0</span>
ã€€âš” +<span id="atk">0</span>
</p>

<div class="player" id="player">ğŸ™‚</div>

<button onclick="drawGacha()">ğŸ° ã‚¬ãƒãƒ£</button>
<button onclick="draw10()">ğŸ° 10é€£</button>
<button onclick="draw100()">ğŸ° 100é€£</button>
<button onclick="drawDiaGacha()">ğŸ’ ä¸Šä½</button>
<button onclick="drawDia10()">ğŸ’ ä¸Šä½10é€£</button>
<button onclick="drawDia100()">ğŸ’ ä¸Šä½100é€£</button>
<button onclick="showDex()">ğŸ“– å›³é‘‘</button>

<hr>

<input id="diaNum" type="number" min="1" placeholder="å¤‰æ›æ•°">
<button onclick="exchangeDia()">ğŸ’°â†’ğŸ’å¤‰æ›</button>

<hr>

<button onclick="toggleAuto()">ğŸ¤– ã‚ªãƒ¼ãƒˆã‚¿ãƒƒãƒ—</button>
<button onclick="startRush()">ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥</button>

<hr>

<div id="select">
<h2>ãƒœã‚¹é¸æŠ</h2>

<button onclick="startBattle('ã‚¹ãƒ©ã‚¤ãƒ ',100,'ğŸŸ¢',10)">ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('ã‚´ãƒ–ãƒªãƒ³',200,'ğŸ‘º',20)">ã‚´ãƒ–ãƒªãƒ³</button>
<button onclick="startBattle('ã‚ªãƒ¼ã‚¯',500,'ğŸ‘¹',50)">ã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('ãƒ‰ãƒ©ã‚´ãƒ³',2000,'ğŸ‰',200)">ãƒ‰ãƒ©ã‚´ãƒ³</button>
<button onclick="startBattle('ç¥ç«œ',8000,'ğŸ²âœ¨',800)">ç¥ç«œ</button>

<hr>
<h3>ğŸ’€ è¶…é«˜HPãƒœã‚¹</h3>

<button onclick="startBattle('è™šç„¡ã®ã‚¹ãƒ©ã‚¤ãƒ ',500000,'âš«',5000)">è™šç„¡ã®ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('ç ´å£Šã‚´ãƒ–ãƒªãƒ³',1200000,'ğŸ’¥',12000)">ç ´å£Šã‚´ãƒ–ãƒªãƒ³</button>
<button onclick="startBattle('ç‹‚æˆ¦å£«ã‚ªãƒ¼ã‚¯',3000000,'ğŸ”¥',35000)">ç‹‚æˆ¦å£«ã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('ç½å„ãƒ‰ãƒ©ã‚´ãƒ³',8000000,'ğŸ‰ğŸ”¥',120000)">ç½å„ãƒ‰ãƒ©ã‚´ãƒ³</button>
<button onclick="startBattle('å •å¤©ç¥ç«œ',20000000,'ğŸ˜ˆğŸ²',300000)">å •å¤©ç¥ç«œ</button>

<button onclick="startBattle('è™šç„¡ã®ã‚´ãƒ–ãƒªãƒ³',35000000,'âš«',400000)">è™šç„¡ã®ã‚´ãƒ–ãƒªãƒ³</button>
<button onclick="startBattle('ç ´æ»…ã‚ªãƒ¼ã‚¯',50000000,'ğŸ’¥',600000)">ç ´æ»…ã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('çµ‚ç„‰ãƒ‰ãƒ©ã‚´ãƒ³',70000000,'ğŸ‰',900000)">çµ‚ç„‰ãƒ‰ãƒ©ã‚´ãƒ³</button>
<button onclick="startBattle('å •è½ç¥ç«œ',100000000,'ğŸ²',1300000)">å •è½ç¥ç«œ</button>
<button onclick="startBattle('æ·±æ·µã®ã‚¹ãƒ©ã‚¤ãƒ ',140000000,'âš«',1800000)">æ·±æ·µã®ã‚¹ãƒ©ã‚¤ãƒ </button>

<button onclick="startBattle('å¥ˆè½ã‚´ãƒ–ãƒªãƒ³',200000000,'ğŸ‘¿',2500000)">å¥ˆè½ã‚´ãƒ–ãƒªãƒ³</button>
<button onclick="startBattle('å†¥ç•Œã‚ªãƒ¼ã‚¯',280000000,'ğŸ‘¿',3500000)">å†¥ç•Œã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('ç ´å£Šç¥ãƒ‰ãƒ©ã‚´ãƒ³',400000000,'ğŸ‰ğŸ”¥',5000000)">ç ´å£Šç¥ãƒ‰ãƒ©ã‚´ãƒ³</button>
<button onclick="startBattle('ç¥æ®ºã—ã®ç«œ',600000000,'ğŸ²âœ¨',8000000)">ç¥æ®ºã—ã®ç«œ</button>
<button onclick="startBattle('è™šç©ºã®ç¥ç«œ',900000000,'â˜ ï¸',12000000)">è™šç©ºã®ç¥ç«œ</button>

<button onclick="startBattle('çµ‚æœ«ã®ã‚¹ãƒ©ã‚¤ãƒ ',1300000000,'â˜ ï¸',18000000)">çµ‚æœ«ã®ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('çµ¶æœ›ã‚´ãƒ–ãƒªãƒ³',1800000000,'â˜ ï¸',25000000)">çµ¶æœ›ã‚´ãƒ–ãƒªãƒ³</button>
<button onclick="startBattle('æ»…ç•Œã‚ªãƒ¼ã‚¯',2500000000,'â˜ ï¸',35000000)">æ»…ç•Œã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('ç½ç¦ç¥ç«œ',3500000000,'â˜ ï¸',50000000)">ç½ç¦ç¥ç«œ</button>
<button onclick="startBattle('ä¸–ç•Œã‚’å–°ã‚‰ã†ç«œ',5000000000,'â˜ ï¸',80000000)">ä¸–ç•Œã‚’å–°ã‚‰ã†ç«œ</button>
</div>

<div id="game" class="hidden">
<h2 id="bossName"></h2>
<div class="boss" id="bossIcon"></div>
<div class="hp-bar"><div class="hp" id="hp"></div></div>
<p>HP: <span id="hpText"></span></p>
<p id="timer"></p>
<button id="tapBtn" onclick="tap()">ã‚¿ãƒƒãƒ—ï¼</button>
</div>

<div id="overlay" class="overlay hidden"></div>

<!-- ===== BGM ===== -->
<audio id="bgmNormal" src="normal.mp3" loop></audio>
<audio id="bgmBattle" src="battle.mp3" loop></audio>
<audio id="bgmRush" src="rush.mp3" loop></audio>

<audio id="bgmHigh1" src="high1.mp3" loop></audio>
<audio id="bgmHigh2" src="high2.mp3" loop></audio>
<audio id="bgmHigh3" src="high3.mp3" loop></audio>
<audio id="bgmHigh4" src="high4.mp3" loop></audio>
<audio id="bgmHigh5" src="high5.mp3" loop></audio>

<script>
/* ===== DOM ===== */
const coinEl=coin=document.getElementById("coin");
const diaEl=document.getElementById("dia");
const atkEl=document.getElementById("atk");
const player=document.getElementById("player");
const select=document.getElementById("select");
const game=document.getElementById("game");
const bossName=document.getElementById("bossName");
const bossIcon=document.getElementById("bossIcon");
const hp=document.getElementById("hp");
const hpText=document.getElementById("hpText");
const overlay=document.getElementById("overlay");
const timerEl=document.getElementById("timer");
const diaNum=document.getElementById("diaNum");

/* ===== BGM ===== */
const bgmNormal=document.getElementById("bgmNormal");
const bgmBattle=document.getElementById("bgmBattle");
const bgmRush=document.getElementById("bgmRush");
const highBgms=[
bgmHigh1,bgmHigh2,bgmHigh3,bgmHigh4,bgmHigh5
];

function stopAllBgm(){
[bgmNormal,bgmBattle,bgmRush,...highBgms].forEach(b=>{
b.pause();b.currentTime=0;
});
}

/* ===== ãƒ‡ãƒ¼ã‚¿ ===== */
let coin=+localStorage.getItem("coin")||0;
let dia=+localStorage.getItem("dia")||0;
let atkBonus=+localStorage.getItem("atkBonus")||0;
let dex=JSON.parse(localStorage.getItem("dex")||"{}");

/* ===== ä¿å­˜ ===== */
function save(){
localStorage.setItem("coin",coin);
localStorage.setItem("dia",dia);
localStorage.setItem("atkBonus",atkBonus);
localStorage.setItem("dex",JSON.stringify(dex));
coinEl.textContent=coin;
diaEl.textContent=dia;
atkEl.textContent=atkBonus.toFixed(1);
player.textContent=atkBonus>=10?"ğŸ‘‘ğŸ”¥":atkBonus>=5?"ğŸ˜âœ¨":"ğŸ™‚";
}
save();
bgmNormal.play();

/* ===== ã‚¬ãƒãƒ£ ===== */
const normal=[["LR",2,1.5],["UR",5,1],["HR",15,0.5],["SR",28,0.3],["R",50,0.1]];
const diaT=[["LR",40,2],["UR",45,1.5],["DIVINE",15,10]];
function roll(t){let r=Math.random()*100,s=0;for(const g of t){s+=g[1];if(r<s)return g;}}

function drawGacha(){if(coin<100)return;coin-=100;const g=roll(normal);atkBonus+=g[2];dex[g[0]]=(dex[g[0]]||0)+1;save();}
function draw10(){if(coin<1000)return;coin-=1000;for(let i=0;i<10;i++){const g=roll(normal);atkBonus+=g[2];dex[g[0]]=(dex[g[0]]||0)+1;}save();}
function draw100(){if(coin<10000)return;coin-=10000;for(let i=0;i<100;i++){const g=roll(normal);atkBonus+=g[2];dex[g[0]]=(dex[g[0]]||0)+1;}save();}
function drawDiaGacha(){if(dia<1)return;dia--;const g=roll(diaT);atkBonus+=g[2];dex[g[0]]=(dex[g[0]]||0)+1;save();}
function drawDia10(){if(dia<10)return;dia-=10;for(let i=0;i<10;i++){const g=roll(diaT);atkBonus+=g[2];dex[g[0]]=(dex[g[0]]||0)+1;}save();}
function drawDia100(){if(dia<100)return;dia-=100;for(let i=0;i<100;i++){const g=roll(diaT);atkBonus+=g[2];dex[g[0]]=(dex[g[0]]||0)+1;}save();}

/* ===== ãƒãƒˆãƒ« ===== */
let bossHp=0,maxHp=0,reward=0;
let rush=false,rushEnd=0,rushCount=0,rushBaseHp=2000;

function startBattle(n,h,i,r){
rush=false;
bossName.textContent=n;
bossIcon.textContent=i;
bossHp=maxHp=h;
reward=r;
timerEl.textContent="";
select.classList.add("hidden");
game.classList.remove("hidden");
stopAllBgm();
if(h>=500000){
highBgms[Math.floor(Math.random()*highBgms.length)].play();
}else{
bgmBattle.play();
}
updateHp();
}

function startRush(){
rush=true;
rushCount=0;
rushBaseHp=3000;
rushEnd=Date.now()+60000;
select.classList.add("hidden");
game.classList.remove("hidden");
stopAllBgm();
bgmRush.play();
nextRushBoss();
}

function nextRushBoss(){
bossHp=maxHp=rushBaseHp;
bossName.textContent="ãƒ©ãƒƒã‚·ãƒ¥ãƒœã‚¹ "+(rushCount+1);
bossIcon.textContent="ğŸ”¥";
rushBaseHp=Math.floor(rushBaseHp*1.25);
updateHp();
}

function tap(){
bossHp-=1+atkBonus;
if(bossHp<=0){
if(rush){
rushCount++;
nextRushBoss();
}else{
coin+=reward;
save();
stopAllBgm();
bgmNormal.play();
game.classList.add("hidden");
select.classList.remove("hidden");
overlay.innerHTML=`ğŸ‰ æ’ƒç ´ï¼<br>${bossName.textContent}<br>ğŸ’° +${reward}<br><small>(ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹)</small>`;
overlay.classList.remove("hidden");
}
}
updateHp();
}

function updateHp(){
hpText.textContent=Math.max(0,Math.ceil(bossHp));
hp.style.width=(bossHp/maxHp*100)+"%";
}

/* ===== ãƒ©ãƒƒã‚·ãƒ¥çµ‚äº† ===== */
setInterval(()=>{
if(!rush)return;
const t=Math.max(0,Math.ceil((rushEnd-Date.now())/1000));
timerEl.textContent="æ®‹ã‚Š "+t+" ç§’";
if(t<=0){
rush=false;
coin+=rushCount*500;
save();
stopAllBgm();
bgmNormal.play();
game.classList.add("hidden");
select.classList.remove("hidden");
overlay.innerHTML=`ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥çµ‚äº†<br>è¨ä¼æ•° ${rushCount}<br>ğŸ’° +${rushCount*500}<br><small>(ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹)</small>`;
overlay.classList.remove("hidden");
}
},200);

/* ===== ã‚ªãƒ¼ãƒˆã‚¿ãƒƒãƒ— ===== */
let auto=false,autoTimer=null;
function toggleAuto(){
auto=!auto;
if(auto){
autoTimer=setInterval(()=>{if(!game.classList.contains("hidden"))tap();},200);
}else{
clearInterval(autoTimer);
}
}
overlay.onclick=()=>overlay.classList.add("hidden");
</script>
</body>
</html>
