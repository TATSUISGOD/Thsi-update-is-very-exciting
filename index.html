<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¿ãƒƒãƒ—RPG å®Œå…¨çµ±åˆç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:#111;color:#fff;font-family:sans-serif;text-align:center;margin:0;padding:20px}
button,input{font-size:14px;padding:8px 14px;margin:4px}
#tapBtn{font-size:26px;padding:28px 56px;margin-top:20px}
.hidden{display:none!important}
.boss{font-size:72px}
.player{font-size:60px}
.hp-bar{width:80%;height:20px;background:#444;margin:10px auto;border-radius:10px;overflow:hidden}
.hp{height:100%;background:red}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;justify-content:center;align-items:center;z-index:999;font-size:20px;text-align:center;padding:20px}
</style>
</head>
<body>

<h1>ğŸ”¥ ã‚¿ãƒƒãƒ—RPG ğŸ”¥</h1>

<p>
ğŸ’° <span id="coin">0</span>
ã€€ğŸ’ <span id="dia">0</span>
ã€€âš” +<span id="atk">0</span>
</p>

<div class="player" id="player">ğŸ™‚</div>

<button onclick="drawGacha()">ğŸ° ã‚¬ãƒãƒ£</button>
<button onclick="draw10()">ğŸ° 10é€£</button>
<button onclick="drawDiaGacha()">ğŸ’ ä¸Šä½</button>
<button onclick="drawDia10()">ğŸ’ ä¸Šä½10é€£</button>
<button onclick="drawDivine()">ğŸŒˆ æ–°ã‚¬ãƒãƒ£</button>
<button onclick="drawDivine10()">ğŸŒˆ æ–°ã‚¬ãƒãƒ£10é€£</button>
<button onclick="showDex()">ğŸ“– å›³é‘‘</button>

<hr>

<input id="diaNum" type="number" min="1" placeholder="å¤‰æ›æ•°">
<button onclick="exchangeDia()">ğŸ’°â†’ğŸ’å¤‰æ›</button>

<hr>

<button onclick="startRush()">ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥</button>

<hr>

<div id="select">
<h2>ãƒœã‚¹é¸æŠ</h2>

<button onclick="startBattle('ã‚¹ãƒ©ã‚¤ãƒ ',100,'ğŸŸ¢','coin',10)">ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('ã‚¹ãƒ©ã‚¤ãƒ ç‹(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)',300,'ğŸ’','dia',1)">ã‚¹ãƒ©ã‚¤ãƒ ç‹(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)</button>

<button onclick="startBattle('ã‚´ãƒ–ãƒªãƒ³',200,'ğŸ‘º','coin',20)">ã‚´ãƒ–ãƒªãƒ³</button>
<button onclick="startBattle('ã‚´ãƒ–ãƒªãƒ³å•†äºº(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)',800,'ğŸ’','dia',2)">ã‚´ãƒ–ãƒªãƒ³å•†äºº(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)</button>

<button onclick="startBattle('ã‚ªãƒ¼ã‚¯',500,'ğŸ‘¹','coin',50)">ã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('ã‚ªãƒ¼ã‚¯è²¡å®å®ˆã‚Š(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)',2000,'ğŸ’','dia',3)">ã‚ªãƒ¼ã‚¯è²¡å®å®ˆã‚Š(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)</button>

<button onclick="startBattle('ãƒ‰ãƒ©ã‚´ãƒ³',2000,'ğŸ‰','coin',200)">ãƒ‰ãƒ©ã‚´ãƒ³</button>
<button onclick="startBattle('ãƒ‰ãƒ©ã‚´ãƒ³çµæ™¶ä½“(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)',6000,'ğŸ’','dia',5)">ãƒ‰ãƒ©ã‚´ãƒ³çµæ™¶ä½“(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)</button>

<button onclick="startBattle('ç¥ç«œ',8000,'ğŸ²','coin',800)">ç¥ç«œ</button>
<button onclick="startBattle('ç¥ç«œã®ä½¿å¾’(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)',15000,'ğŸ’','dia',10)">ç¥ç«œã®ä½¿å¾’(ãƒ€ã‚¤ãƒ¤ã‚­ãƒ£ãƒ©)</button>

<hr>
<h3>ğŸ’€ è¶…é«˜HPãƒœã‚¹</h3>

<button onclick="startBattle('è™šç„¡ã®ã‚¹ãƒ©ã‚¤ãƒ ',500000,'âš«','coin',5000)">è™šç„¡ã®ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('ç ´å£Šã‚´ãƒ–ãƒªãƒ³',1200000,'ğŸ’¥','coin',12000)">ç ´å£Šã‚´ãƒ–ãƒªãƒ³</button>
<button onclick="startBattle('ç‹‚æˆ¦å£«ã‚ªãƒ¼ã‚¯',3000000,'ğŸ”¥','coin',35000)">ç‹‚æˆ¦å£«ã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('ç½å„ãƒ‰ãƒ©ã‚´ãƒ³',8000000,'ğŸ‰ğŸ”¥','coin',120000)">ç½å„ãƒ‰ãƒ©ã‚´ãƒ³</button>
<button onclick="startBattle('å •å¤©ç¥ç«œ',20000000,'ğŸ˜ˆğŸ²','coin',300000)">å •å¤©ç¥ç«œ</button>

</div>

<div id="game" class="hidden">
<h2 id="bossName"></h2>
<div class="boss" id="bossIcon"></div>
<div class="hp-bar"><div class="hp" id="hp"></div></div>
<p>HP: <span id="hpText"></span></p>
<p id="timer"></p>
<button id="tapBtn" onclick="tap()">ã‚¿ãƒƒãƒ—ï¼</button>
</div>

<div id="overlay" class="overlay hidden"></div>

<script>
const coinEl=document.getElementById("coin");
const diaEl=document.getElementById("dia");
const atkEl=document.getElementById("atk");
const overlay=document.getElementById("overlay");
const timerEl=document.getElementById("timer");

let coin=+localStorage.getItem("coin")||0;
let dia=+localStorage.getItem("dia")||0;
let atkBonus=+localStorage.getItem("atkBonus")||0;
let dex=JSON.parse(localStorage.getItem("dex")||"{}");

function save(){
localStorage.setItem("coin",coin);
localStorage.setItem("dia",dia);
localStorage.setItem("atkBonus",atkBonus);
localStorage.setItem("dex",JSON.stringify(dex));
coinEl.textContent=coin;
diaEl.textContent=dia;
atkEl.textContent=atkBonus.toFixed(1);
}
save();

function show(title,lines){
overlay.innerHTML=title+"<br>"+lines.join("<br>")+"<br><small>(ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹)</small>";
overlay.classList.remove("hidden");
}
overlay.onclick=()=>overlay.classList.add("hidden");

/* ===== ã‚¬ãƒãƒ£ ===== */
function roll(t){let r=Math.random()*100,s=0;for(const g of t){s+=g[1];if(r<s)return g;}}
const normal=[["R",50,0.1],["SR",30,0.3],["UR",15,1],["LR",5,2]];
const diaT=[["UR",60,1.5],["LR",30,3],["DIVINE",10,10]];
const divineT=[["ãƒ‡ã‚£ãƒã‚¤ãƒ³",50,10],["ãƒ‡ã‚£ãƒã‚¤ãƒ³â…¡",33,100],["ãƒ‡ã‚£ãƒã‚¤ãƒ³â…¢",17,1000]];

function drawGacha(){if(coin<100)return;coin-=100;const g=roll(normal);atkBonus+=g[2];save();show("ğŸ° ã‚¬ãƒãƒ£çµæœ",[`${g[0]} +${g[2]}`]);}
function draw10(){if(coin<1000)return;coin-=1000;let r=[];for(let i=0;i<10;i++){const g=roll(normal);atkBonus+=g[2];r.push(`${g[0]} +${g[2]}`);}save();show("ğŸ° 10é€£çµæœ",r);}
function drawDiaGacha(){if(dia<1)return;dia--;const g=roll(diaT);atkBonus+=g[2];save();show("ğŸ’ ä¸Šä½ã‚¬ãƒãƒ£",[`${g[0]} +${g[2]}`]);}
function drawDia10(){if(dia<10)return;dia-=10;let r=[];for(let i=0;i<10;i++){const g=roll(diaT);atkBonus+=g[2];r.push(`${g[0]} +${g[2]}`);}save();show("ğŸ’ ä¸Šä½10é€£",r);}
function drawDivine(){if(dia<1000)return;dia-=1000;const g=roll(divineT);atkBonus+=g[2];save();show("ğŸŒˆ æ–°ã‚¬ãƒãƒ£",[`${g[0]} +${g[2]}`]);}
function drawDivine10(){if(dia<10000)return;dia-=10000;let r=[];for(let i=0;i<10;i++){const g=roll(divineT);atkBonus+=g[2];r.push(`${g[0]} +${g[2]}`);}save();show("ğŸŒˆ æ–°ã‚¬ãƒãƒ£10é€£",r);}

function exchangeDia(){
const n=+document.getElementById("diaNum").value;
if(!n||coin<n*1000)return;
coin-=n*1000;dia+=n;save();
show("ğŸ’± å¤‰æ›æˆåŠŸ",[ `ğŸ’ +${n}` ]);
}

/* ===== æˆ¦é—˜ & ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥ ===== */
let bossHp=0,maxHp=0,reward=0,rewardType="coin";
let rush=false,rushEnd=0,rushCount=0,rushHp=3000;

function startBattle(n,h,i,t,v){
rush=false;
bossHp=maxHp=h;
reward=v;rewardType=t;
bossName.textContent=n;
bossIcon.textContent=i;
timerEl.textContent="";
select.classList.add("hidden");
game.classList.remove("hidden");
updateHp();
}

function startRush(){
rush=true;
rushCount=0;
rushHp=3000;
rushEnd=Date.now()+60000;
nextRush();
select.classList.add("hidden");
game.classList.remove("hidden");
}

function nextRush(){
bossHp=maxHp=rushHp;
bossName.textContent="ãƒ©ãƒƒã‚·ãƒ¥ãƒœã‚¹ "+(rushCount+1);
bossIcon.textContent="ğŸ”¥";
rushHp=Math.floor(rushHp*1.25);
updateHp();
}

function tap(){
bossHp-=1+atkBonus;
if(bossHp<=0){
if(rush){
rushCount++;
nextRush();
}else{
rewardType==="coin"?coin+=reward:dia+=reward;
save();
game.classList.add("hidden");
select.classList.remove("hidden");
show("ğŸ‰ æ’ƒç ´",[rewardType==="coin"?`ğŸ’° +${reward}`:`ğŸ’ +${reward}`]);
}
}
updateHp();
}

function updateHp(){
hpText.textContent=Math.max(0,Math.ceil(bossHp));
hp.style.width=(bossHp/maxHp*100)+"%";
}

setInterval(()=>{
if(!rush)return;
const t=Math.max(0,Math.ceil((rushEnd-Date.now())/1000));
timerEl.textContent="æ®‹ã‚Š "+t+" ç§’";
if(t<=0){
rush=false;
coin+=rushCount*500;
save();
game.classList.add("hidden");
select.classList.remove("hidden");
show("ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥çµ‚äº†",[ `è¨ä¼æ•° ${rushCount}`,`ğŸ’° +${rushCount*500}` ]);
}
},200);
</script>
</body>
</html>
